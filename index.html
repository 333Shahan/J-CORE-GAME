<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>J-CORE | Multiplayer Pong</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap');
        
        body { background: #050010; color: #fff; font-family: 'Montserrat', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }

        /* --- RGB LOGIN --- */
        #login-screen { position: fixed; inset: 0; background: #050010; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { text-align: center; padding: 40px; border: 3px solid; border-image: linear-gradient(45deg, #00ffcc, #ff00a0) 1; background: rgba(0,0,0,0.8); border-radius: 20px; box-shadow: 0 0 30px rgba(0,255,204,0.3); }
        h1 { font-size: 2.5rem; margin: 0; background: linear-gradient(to right, #00ffcc, #ff00a0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* --- WAITING ROOM --- */
        #waiting-room { display: none; text-align: center; }
        .heart-pulse { font-size: 50px; animation: pulse 1s infinite; margin: 20px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

        /* --- PONG ARENA --- */
        #game-screen { display: none; text-align: center; }
        canvas { background: #000; border: 2px solid #ff00a0; border-radius: 10px; box-shadow: 0 0 20px #ff00a0; touch-action: none; }
        
        .btn { background: linear-gradient(45deg, #ff0055, #ff00a0); border: none; color: white; padding: 15px 40px; border-radius: 50px; font-weight: 900; cursor: pointer; margin-top: 20px; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 12px; margin: 10px 0; width: 200px; border-radius: 10px; text-align: center; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h1>J-CORE</h1>
            <p style="font-size: 10px; letter-spacing: 3px; color: #00ffcc;">OFFICIAL ROMANCE ARENA</p>
            <input type="text" id="username" placeholder="NAME">
            <button class="btn" onclick="joinArena()">LOGIN</button>
        </div>
    </div>

    <div id="waiting-room">
        <h1>WAITING...</h1>
        <div class="heart-pulse">ðŸ’–</div>
        <p id="wait-msg">Waiting for your partner to join the Arena...</p>
    </div>

    <div id="game-screen">
        <div style="margin-bottom: 10px; color: #00ffcc;">JOHAN vs MAHEEN</div>
        <canvas id="pongCanvas"></canvas>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAZwCbtIVf4BwXRWuFkkOEPw_Kt3TQGIWc",
            databaseURL: "https://j-core-8eb11-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const presenceRef = db.ref("arena_presence");

        function joinArena() {
            const user = document.getElementById("username").value;
            if(!user) return alert("Enter Name!");

            document.getElementById("login-screen").style.display = "none";
            document.getElementById("waiting-room").style.display = "block";

            // Add user to presence list
            const myPresence = presenceRef.push(user);
            myPresence.onDisconnect().remove();

            // Listen for 2 users
            presenceRef.on("value", (snap) => {
                const count = snap.numChildren();
                if(count >= 2) {
                    startGame();
                }
            });
        }

        function startGame() {
            document.getElementById("waiting-room").style.display = "none";
            document.getElementById("game-screen").style.display = "block";
            initPong();
        }

        function initPong() {
            const canvas = document.getElementById("pongCanvas");
            const ctx = canvas.getContext("2d");
            canvas.width = 300; canvas.height = 400;

            let ballX = 150, ballY = 200, dx = 2, dy = 2;
            let paddleX = 115;

            canvas.addEventListener("mousemove", (e) => {
                const rect = canvas.getBoundingClientRect();
                paddleX = (e.clientX - rect.left) - 35;
            });

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Ball
                ctx.font = "20px Arial";
                ctx.fillText("ðŸ’–", ballX - 10, ballY + 10);
                
                // Bottom Paddle
                ctx.fillStyle = "#00ffcc";
                ctx.fillRect(paddleX, canvas.height - 15, 70, 10);

                ballX += dx; ballY += dy;
                if(ballX < 0 || ballX > canvas.width) dx = -dx;
                if(ballY < 0) dy = -dy;
                if(ballY > canvas.height - 25 && ballX > paddleX && ballX < paddleX + 70) dy = -dy;
                if(ballY > canvas.height) { ballX = 150; ballY = 200; }

                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>
